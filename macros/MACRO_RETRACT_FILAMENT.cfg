[gcode_macro RETRACT_FILAMENT]
description: Macro to retract filament
default_parameter_RETRACT_LENGTH: 3
gcode:
    {% set MIN_TEMP = (printer.configfile.config["extruder"]["min_extrude_temp"] | min) %}
    {% if (printer.extruder.temperature >= (MIN_TEMP|int)) %}
        G91 ; relative positioning
        M118 RETRACT_FILAMENT: Retracting filament by {RETRACT_LENGTH}mm
        G1 E-{RETRACT_LENGTH} F2100 ; retract filament
        G90 ; absolute positioning
    {% else %}
        M118 RETRACT_FILAMENT: Skipped retracting filamant due to min-temp condition {MIN_TEMP}, current extruder temperature is {printer.extruder.temperature}
    {% endif %}

